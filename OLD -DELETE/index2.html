<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Charts</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3"></script>  <!-- Include date adapter -->
    <style>
        body { 
            font-family: Arial, sans-serif; 
        }
        .container { 
            width: 80%; 
            margin: auto; 
        }
        .dropdown { 
            margin: 20px; 
        }
        canvas {
            width: 100%;  /* Set to 100% of the parent container */
            height: 400px;  /* Ensure height is a reasonable size, like 400px */
            margin-bottom: 50px;  /* Add space between the charts */
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Interactive Data Charts (2018-2022)</h1>

        <!-- Dropdown for HHI, Unemployment, Mortgage Data (Chart 1) -->
        <div class="dropdown">
            <label for="dataset1">Choose Data for Chart 1:</label>
            <select id="dataset1" onchange="updateChart1()">
                <option value="median_hhi">Median HHI 2018-2022</option>
                <option value="unemployment_data">Unemployment Data 2018-2022</option>
                <option value="average_mortgage">Average Mortgage 2018-2022</option>
            </select>
        </div>

        <!-- Canvas for Chart 1 -->
        <canvas id="chart1"></canvas>

        <!-- Dropdown for Sales/Rentals Data (Chart 2) -->
        <div class="dropdown">
            <label for="dataset2">Choose Data for Chart 2:</label>
            <select id="dataset2" onchange="updateChart2()">
                <option value="sales">US Sales Data 2018-2022</option>
                <option value="rental">US Rental Data 2018-2022</option>
            </select>
        </div>

        <!-- Canvas for Chart 2 -->
        <canvas id="chart2"></canvas>
    </div>

    <script>
        let chart1, chart2;

        // Fetch data from the Flask API based on selected dataset
        function fetchData(dataset, callback) {
            fetch(`/get_data/${dataset}`)
                .then(response => response.json())
                .then(data => {
                    console.log('Fetched data:', data);  // Debug: Log the fetched data
                    callback(data);
                })
                .catch(error => console.error('Error fetching data:', error));  // Catch fetch errors
        }

// Update Chart 1 for HHI, Unemployment, Mortgage Data
function updateChart1() {
    const dataset1 = document.getElementById('dataset1').value;
    fetchData(dataset1, (data) => {
        // Extract and format labels (dates) and values
        const labels = Object.keys(data).map(date => new Date(date));
        const values = Object.values(data).map(d => Object.values(d)[0]);

        console.log('Labels (dates):', labels);  // Debug log to see if date data is correct
        console.log('Values:', values);

        // Destroy the existing chart if it exists
        if (chart1) chart1.destroy();

        chart1 = new Chart(document.getElementById('chart1'), {
            type: 'line',
            data: {
                labels: labels,  // Format labels as Date objects
                datasets: [{
                    label: dataset1.replace('_', ' ').toUpperCase(),
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    data: values,
                    fill: false,
                    tension: 0.1  // Add some smoothness to the line
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,  // Adjusts canvas size
                scales: {
                    x: { 
                        type: 'time',  // Use time scale for date-based x-axis
                        time: {
                            unit: 'year',  // Display ticks for each year
                            tooltipFormat: 'YYYY'  // Tooltip format for year
                        },
                        title: {
                            display: true,
                            text: 'Year'
                        }
                    },
                    y: { 
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Value'
                        }
                    }
                }
            }
        });
    });
}

// Update Chart 2 for Sales and Rentals Data
function updateChart2() {
    const dataset2 = document.getElementById('dataset2').value;
    fetchData(dataset2, (data) => {
        // Extract and format labels (dates) and values
        const labels = Object.keys(data).map(date => new Date(date));
        const values = Object.values(data).map(d => d.Sales || d.Rentals);

        console.log('Labels (dates):', labels);  // Debug log for date-based labels
        console.log('Values:', values);  // Log sales/rentals values

        if (chart2) chart2.destroy();  // Destroy old chart instance

        chart2 = new Chart(document.getElementById('chart2'), {
            type: 'line',
            data: {
                labels: labels,  // Use formatted Date objects for labels
                datasets: [{
                    label: dataset2 === 'rental' ? 'Rentals' : 'Sales',
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    data: values,
                    fill: false,
                    tension: 0.1  // Add smoothness to the line
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { 
                        type: 'time',  // Use time scale for x-axis
                        time: {
                            unit: 'year',
                            tooltipFormat: 'YYYY'
                        },
                        title: {
                            display: true,
                            text: 'Year'
                        }
                    },
                    y: { 
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Value'
                        }
                    }
                }
            }
        });
    });
}
// Load the initial charts on page load
updateChart1();  // Load Chart 1 with the default dataset (Median HHI)
updateChart2();  // Load Chart 2 with the default dataset (Sales)
    </script>
</body>
</html>